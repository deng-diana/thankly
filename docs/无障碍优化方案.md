# 🎯 thankly 应用无障碍优化方案

> **制定原则：** 基于 Apple Human Interface Guidelines 和 WCAG 2.1 AA 标准，特别关注视障人士需求，打造真正有温度的、包容性的产品体验。

---

## 📋 一、方案概述

### 优化目标
1. **视觉无障碍**：支持视障用户（全盲、低视力、色盲）
2. **听觉无障碍**：支持听障用户
3. **运动无障碍**：支持运动障碍用户（精细操作困难）
4. **认知无障碍**：支持认知障碍用户（理解困难）

### 核心标准参考
- **Apple HIG - Accessibility**：最小点击区域 44x44pt、VoiceOver 支持、动态字体、颜色对比度
- **WCAG 2.1 Level AA**：颜色对比度 ≥4.5:1、键盘导航、屏幕阅读器支持
- **React Native Accessibility API**：`accessibilityLabel`、`accessibilityRole`、`accessibilityHint`、`accessibilityState`

---

## 🎨 二、视觉无障碍优化

### 2.1 屏幕阅读器支持（VoiceOver / TalkBack）

#### 当前问题
- ✅ 部分按钮已有 `accessibilityLabel`
- ❌ 文本输入框缺少语义化标签
- ❌ 动态内容缺少状态更新提示
- ❌ 音频播放器缺少播放状态描述
- ❌ 列表项缺少索引和总数信息

#### 优化方案

**A. 文本输入框完善**
```typescript
// 所有 TextInput 组件需要添加：
<TextInput
  accessibilityLabel={t("login.emailPlaceholder")}  // 清晰的标签
  accessibilityHint={t("login.emailHint")}          // 使用提示
  accessibilityRole="text"                          // 明确角色
  accessibilityState={{ disabled: loading }}       // 状态信息
/>
```

**需要优化的输入框：**
- [ ] 登录页：邮箱输入框、密码输入框
- [ ] 姓名输入框（NameInputModal）
- [ ] 文本日记输入框（TextInputModal）
- [ ] 验证码输入框（VerificationCodeModal）
- [ ] 日记编辑输入框（DiaryDetailScreen）

**B. 音频播放器状态描述**
```typescript
// AudioPlayer 组件需要：
<TouchableOpacity
  accessibilityLabel={
    isPlaying 
      ? t("audio.playing", { remaining: formatTime(remaining), total: formatTime(total) })
      : t("audio.paused", { total: formatTime(total) })
  }
  accessibilityRole="button"
  accessibilityState={{ 
    playing: isPlaying,
    disabled: !audioUrl 
  }}
  accessibilityHint={t("audio.hint")}  // "双击播放或暂停音频"
/>
```

**C. 动态内容实时更新**
```typescript
// 使用 accessibilityLiveRegion 通知屏幕阅读器
<View accessibilityLiveRegion="polite">
  {processing && (
    <Text accessibilityLabel={t("diary.processing", { step: currentStep })}>
      处理中...
    </Text>
  )}
</View>
```

**需要添加动态更新的场景：**
- [ ] 录音时长变化
- [ ] 处理进度更新
- [ ] 加载状态变化
- [ ] 错误提示出现
- [ ] 成功提示出现

**D. 列表项导航信息**
```typescript
// FlatList 中的日记卡片需要：
<View
  accessibilityLabel={`${t("diary.card")} ${index + 1} ${t("common.of")} ${total}, ${diary.title}`}
  accessibilityRole="button"
  accessibilityHint={t("diary.cardHint")}  // "双击查看日记详情"
>
```

---

### 2.2 颜色对比度优化

#### 当前问题
- ❌ 未检查颜色对比度是否符合 WCAG AA 标准（≥4.5:1）
- ❌ 可能存在的低对比度颜色组合

#### 优化方案

**A. 颜色对比度检查清单**
需要检查并优化的颜色组合：
- [ ] 主题色 `#E56C45` 在背景 `#FAF6ED` 上的对比度
- [ ] 文字 `#666` 在背景 `#fff` 上的对比度
- [ ] 文字 `#332824` 在背景 `#FAF6ED` 上的对比度
- [ ] 按钮文字在按钮背景上的对比度
- [ ] 错误提示文字 `#FF3B30` 的对比度

**B. 对比度增强方案**
- 如果对比度不足，调整颜色值或使用半透明遮罩
- 为低对比度场景提供"高对比度模式"选项

---

### 2.3 动态字体支持

#### 当前问题
- ✅ 已使用 Typography 系统
- ❌ 未使用系统字体缩放设置
- ❌ 固定字体大小可能影响可读性

#### 优化方案

**A. 支持系统字体缩放**
```typescript
// 使用 PixelRatio 和系统字体缩放
import { PixelRatio } from 'react-native';
import { useAccessibilityInfo } from '@react-native-community/hooks';

const scale = PixelRatio.getFontScale(); // 获取系统字体缩放比例
const fontSize = 16 * Math.max(1, Math.min(scale, 1.5)); // 限制最大缩放1.5倍
```

**B. 响应式字体大小**
- 所有文本使用相对单位，支持系统缩放
- 确保缩放后布局不会破坏

---

### 2.4 减少动画选项（针对光敏感用户）

#### 当前问题
- ❌ 没有减少动画的选项
- ❌ 动画可能触发光敏感用户的症状

#### 优化方案

**A. 检测系统设置**
```typescript
import { useAccessibilityInfo } from '@react-native-community/hooks';

const { reduceMotionEnabled } = useAccessibilityInfo();

// 如果用户开启了"减少动画"，则：
const shouldAnimate = !reduceMotionEnabled;
```

**B. 关键动画优化**
需要优化的动画：
- [ ] 录音波形动画（如果 reduceMotionEnabled，使用静态指示器）
- [ ] 处理进度动画（使用简化版本）
- [ ] Modal 打开/关闭动画（使用淡入淡出代替滑动）
- [ ] 列表项动画（禁用自动动画）

---

## 🔊 三、听觉无障碍优化

### 3.1 音频转录文字显示

#### 当前问题
- ✅ 已有语音转文字功能
- ❌ 音频播放时没有实时字幕显示

#### 优化方案

**A. 音频播放时显示转录文字**
- 在音频播放器下方显示转录的文字内容
- 支持高亮当前播放位置对应的文字

---

### 3.2 视觉反馈增强

#### 当前问题
- ✅ 有视觉反馈
- ❌ 缺少重要的视觉提示替代音频提示

#### 优化方案

**A. 重要操作使用视觉提示**
- 录音开始/结束：使用明显的视觉指示（颜色变化、图标变化）
- 错误提示：使用醒目的视觉样式，不只是Toast
- 成功提示：使用确认动画

---

## 🎯 四、运动无障碍优化

### 4.1 点击区域优化（已完成部分）

#### 当前状态
- ✅ 底部按钮已优化为 44x44pt
- ✅ 三个点菜单按钮已优化
- ✅ 顶部头像按钮已优化

#### 进一步优化

**A. 检查所有交互元素**
需要确保所有可点击元素至少 44x44pt：
- [ ] 日记卡片（整个卡片应该是可点击区域）
- [ ] 关闭按钮（Modal 中的 X 按钮）
- [ ] 密码显示/隐藏按钮
- [ ] 验证码输入框的每个数字框
- [ ] 所有列表项的操作按钮

---

### 4.2 手势操作替代

#### 当前问题
- ❌ 可能依赖复杂手势（如长按、滑动）
- ❌ 缺少按钮替代手势操作

#### 优化方案

**A. 所有手势操作提供按钮替代**
- 长按删除 → 提供"删除"按钮
- 滑动操作 → 提供操作菜单
- 下拉刷新 → 提供"刷新"按钮（可选）

---

## 🧠 五、认知无障碍优化

### 5.1 清晰的错误提示

#### 当前问题
- ❌ 错误提示可能不够清晰
- ❌ 缺少操作建议

#### 优化方案

**A. 错误提示优化**
```typescript
// 错误提示应该包含：
1. 发生了什么（清晰的描述）
2. 为什么发生（原因说明）
3. 如何解决（操作建议）

// 示例：
t("error.recordingFailed.title")      // "录音失败"
t("error.recordingFailed.reason")     // "麦克风权限被拒绝"
t("error.recordingFailed.solution")   // "请前往设置允许麦克风权限"
```

---

### 5.2 操作确认和撤销

#### 当前问题
- ❌ 删除操作可能没有确认
- ❌ 缺少撤销功能

#### 优化方案

**A. 重要操作添加确认**
- 删除日记：显示确认对话框，包含撤销选项（5秒内）
- 退出登录：显示确认对话框

---

## 📱 六、React Native 特定优化

### 6.1 accessibilityRole 完善

#### 需要添加的角色类型
```typescript
// 所有交互元素需要明确的 role：
- "button"     // 按钮
- "text"       // 文本输入
- "header"     // 标题
- "link"       // 链接（隐私政策等）
- "image"      // 图片（需要添加描述）
- "list"       // 列表
- "listitem"   // 列表项
- "progressbar" // 进度条
- "alert"      // 警告信息
```

---

### 6.2 accessibilityHint 添加

#### 需要添加操作提示的场景
- 所有按钮：说明点击后的操作
- 输入框：说明输入要求和格式
- 列表项：说明如何查看更多详情
- 音频播放器：说明播放/暂停操作

---

### 6.3 accessibilityState 完善

#### 需要添加的状态信息
```typescript
// 按钮状态
accessibilityState={{ 
  disabled: isLoading,
  selected: isSelected,
  checked: isChecked 
}}

// 输入框状态
accessibilityState={{ 
  disabled: !editable,
  busy: isProcessing 
}}

// 音频播放器状态
accessibilityState={{ 
  playing: isPlaying,
  paused: isPaused 
}}
```

---

## 🎨 七、用户体验优化

### 7.1 焦点管理

#### 当前问题
- ❌ Modal 打开时焦点可能不在正确位置
- ❌ 键盘关闭后焦点可能丢失

#### 优化方案

**A. Modal 焦点管理**
```typescript
// Modal 打开时，焦点应该自动移动到第一个输入框
<Modal
  accessible={true}
  accessibilityViewIsModal={true}
>
  <TextInput
    ref={firstInputRef}
    autoFocus={true}
    accessibilityFocus={true}  // 确保屏幕阅读器聚焦
  />
</Modal>
```

---

### 7.2 键盘导航支持（Web/Desktop）

#### 当前问题
- ❌ 可能不支持键盘导航（Tab、Enter、Esc）

#### 优化方案

**A. 键盘导航支持**
- Tab：在可聚焦元素间切换
- Enter：激活按钮或提交表单
- Esc：关闭 Modal

---

## 📊 八、实施优先级

### 🔴 P0 - 必须立即实施（影响核心功能）
1. **所有文本输入框添加 accessibilityLabel**
2. **所有按钮添加 accessibilityHint**
3. **音频播放器状态描述**
4. **动态内容使用 accessibilityLiveRegion**
5. **颜色对比度检查与修复**

### 🟡 P1 - 高优先级（显著提升体验）
6. **列表项导航信息**
7. **错误提示优化（包含解决方案）**
8. **Modal 焦点管理**
9. **所有交互元素确保 44x44pt 点击区域**
10. **支持系统字体缩放**

### 🟢 P2 - 中优先级（优化体验）
11. **减少动画选项**
12. **重要操作添加确认对话框**
13. **手势操作提供按钮替代**
14. **音频播放时显示转录文字**

### 🔵 P3 - 低优先级（锦上添花）
15. **键盘导航支持**
16. **高对比度模式选项**
17. **自定义字体大小设置**

---

## 🧪 九、测试方案

### 9.1 测试工具
- **iOS**: VoiceOver（设置 → 辅助功能 → VoiceOver）
- **Android**: TalkBack（设置 → 辅助功能 → TalkBack）
- **颜色对比度**: WebAIM Contrast Checker
- **自动化测试**: React Native Testing Library + Jest

### 9.2 测试清单
- [ ] 所有按钮可以用屏幕阅读器识别和操作
- [ ] 所有输入框有清晰的标签和提示
- [ ] 动态内容更新时屏幕阅读器会通知
- [ ] 颜色对比度符合 WCAG AA 标准
- [ ] 系统字体缩放后布局正常
- [ ] 减少动画选项生效
- [ ] 所有交互元素至少 44x44pt

---

## 📝 十、翻译键补充计划

### 需要新增的翻译键

**无障碍相关：**
```typescript
// en.ts 和 zh.ts 需要添加：

accessibility: {
  // 音频播放器
  audio: {
    playing: "Playing audio, {remaining} remaining of {total}",
    paused: "Audio paused, {total} total duration",
    hint: "Double tap to play or pause audio",
    noAudio: "No audio available",
  },
  
  // 输入框提示
  input: {
    emailHint: "Enter your email address",
    passwordHint: "Enter your password",
    nameHint: "Enter your name or nickname",
    textHint: "Write your diary entry here",
    codeHint: "Enter the verification code",
  },
  
  // 按钮提示
  button: {
    recordHint: "Double tap to start recording",
    stopHint: "Double tap to stop recording",
    saveHint: "Double tap to save your diary",
    deleteHint: "Double tap to delete this diary",
    editHint: "Double tap to edit this diary",
    closeHint: "Double tap to close",
  },
  
  // 列表和导航
  list: {
    diaryCard: "Diary entry",
    of: "of",
    cardHint: "Double tap to view diary details",
    emptyList: "No diary entries yet",
  },
  
  // 状态提示
  status: {
    loading: "Loading",
    processing: "Processing, step {step}",
    saving: "Saving your diary",
    saved: "Diary saved successfully",
    error: "An error occurred",
  },
  
  // 错误提示（包含解决方案）
  error: {
    recordingFailed: {
      title: "Recording failed",
      reason: "Microphone permission denied",
      solution: "Please allow microphone access in Settings",
    },
    networkError: {
      title: "Network error",
      reason: "Unable to connect to server",
      solution: "Please check your internet connection and try again",
    },
  },
}
```

---

## 🎯 十一、实施方案总结

### 预计工作量
- **P0 任务**: 2-3 天
- **P1 任务**: 2-3 天
- **P2 任务**: 1-2 天
- **P3 任务**: 1 天

**总计**: 约 6-9 天

### 实施步骤
1. **第一阶段（P0）**: 核心无障碍功能
2. **第二阶段（P1）**: 体验优化
3. **第三阶段（P2-P3）**: 高级功能

---

## 📚 参考资源

- [Apple Human Interface Guidelines - Accessibility](https://developer.apple.com/design/human-interface-guidelines/accessibility)
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [React Native Accessibility](https://reactnative.dev/docs/accessibility)
- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)

---

**方案制定日期**: 2025-01-XX  
**方案版本**: v1.0  
**制定人**: AI 无障碍设计专家

---

## ✅ 请确认

如果您同意此方案，我将按照优先级顺序开始实施。请告诉我：
1. 是否同意整体方案？
2. 是否需要调整优先级？
3. 是否需要先实施某个特定部分？

