# è¯­éŸ³å¤„ç†æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ V2 - ä¸“å®¶çº§è®¾è®¡

> **ä½œè€…**: CTO & AI Product Engineering Team
> **æ—¥æœŸ**: 2026-01-30
> **ç›®æ ‡**: è¾¾åˆ° Wispr Flow çº§åˆ«çš„å®æ—¶ä½“éªŒ

---

## 1. é—®é¢˜è¯Šæ–­ï¼šä¸ºä»€ä¹ˆ OpenAI API è¿™ä¹ˆæ…¢ï¼Ÿ

### 1.1 å½“å‰æ€§èƒ½æ•°æ®

| æŒ‡æ ‡ | å½“å‰å€¼ | è¡Œä¸šæ ‡å‡† | å·®è· |
|------|--------|----------|------|
| **Whisper è½¬å½•** | 14s (16séŸ³é¢‘) | 2-3s | ğŸ”´ 5-7x æ…¢ |
| **GPT-4o æƒ…ç»ªåˆ†æ** | 10s | 1-3s | ğŸ”´ 3-5x æ…¢ |
| **GPT-4o-mini æ¶¦è‰²** | 10s | 0.5-1.5s | ğŸ”´ 7-10x æ…¢ |
| **æ€»æµç¨‹** | 30s | 5-10s | ğŸ”´ 3-6x æ…¢ |

### 1.2 æ ¹å› åˆ†æ

ç»è¿‡ä»£ç å®¡æŸ¥ï¼Œæ’é™¤äº†ä»¥ä¸‹é—®é¢˜ï¼š
- âœ… ä»£ç æ­£ç¡®ä½¿ç”¨ AsyncOpenAI å®¢æˆ·ç«¯
- âœ… ä¸‰ä¸ª GPT ä»»åŠ¡ç¡®å®å¹¶è¡Œæ‰§è¡Œ
- âœ… éŸ³é¢‘å‹ç¼©å·²ç”Ÿæ•ˆ (161KB/16s)
- âœ… Lambda æ— å†·å¯åŠ¨ (warmup ç”Ÿæ•ˆ)

**çœŸæ­£çš„ç“¶é¢ˆåœ¨äº Lambda â†’ OpenAI çš„ç½‘ç»œè·¯å¾„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lambda (us-east-1)                                                   â”‚
â”‚   â†“                                                                  â”‚
â”‚ VPC (å¦‚æœæœ‰) â†’ NAT Gateway â†’ Internet Gateway                        â”‚
â”‚   â†“                                                                  â”‚
â”‚ AWS Network â†’ ISP â†’ OpenAI CDN â†’ OpenAI API Servers                 â”‚
â”‚                                                                      â”‚
â”‚ æ¯ä¸ªæ­¥éª¤éƒ½å¯èƒ½å¢åŠ å»¶è¿Ÿï¼š                                              â”‚
â”‚ â€¢ NAT Gateway: +1-2ms ä½†å¯èƒ½æœ‰å¸¦å®½é™åˆ¶                               â”‚
â”‚ â€¢ TLS æ¡æ‰‹: é¦–æ¬¡è¿æ¥ +100-300ms                                      â”‚
â”‚ â€¢ OpenAI é˜Ÿåˆ—: é«˜å³°æœŸ +500ms-5s                                      â”‚
â”‚ â€¢ æ¨¡å‹æ¨ç†: gpt-4o æ¯” mini æ…¢ 2-3x                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 OpenAI API æ…¢çš„å¯èƒ½åŸå› 

| åŸå›  | å¯èƒ½æ€§ | éªŒè¯æ–¹æ³• |
|------|--------|----------|
| **OpenAI æœåŠ¡æ³¢åŠ¨** | é«˜ | æ£€æŸ¥ status.openai.com |
| **Lambda VPC ç½‘ç»œ** | ä¸­ | æ£€æŸ¥ Lambda æ˜¯å¦åœ¨ VPC ä¸­ |
| **æ— è¿æ¥æ± å¤ç”¨** | ä¸­ | æ¯æ¬¡è¯·æ±‚éƒ½å»ºç«‹æ–°è¿æ¥ |
| **Prompt è¿‡é•¿** | ä½ | æƒ…ç»ªåˆ†æ prompt ~1500 tokens |
| **è´¦æˆ· Tier é™åˆ¶** | ä½ | æ£€æŸ¥ OpenAI è´¦æˆ·ç­‰çº§ |

---

## 2. è§£å†³æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ A: Base64 ç›´ä¼  (å¿«é€Ÿä¼˜åŒ–)

```
å½“å‰:  å®¢æˆ·ç«¯ â†’ é¢„ç­¾åURL â†’ S3 â†’ åç«¯ä¸‹è½½ â†’ Whisper
ä¼˜åŒ–å: å®¢æˆ·ç«¯ â†’ åç«¯(Base64) â†’ Whisper
èŠ‚çœ:  2-4 ç§’ (æ¶ˆé™¤ S3 å¾€è¿”)
```

**ä¼˜ç‚¹**:
- å®ç°ç®€å•ï¼Œ1-2 å¤©å®Œæˆ
- æ¶ˆé™¤ S3 ä¸­é—´å±‚
- å‡å°‘ç½‘ç»œå¾€è¿”

**ç¼ºç‚¹**:
- API Gateway é™åˆ¶ 10MB
- Base64 å¢åŠ  33% ä½“ç§¯
- å¯¹é•¿å½•éŸ³ (>5åˆ†é’Ÿ) ä¸é€‚ç”¨

**è¯„ä¼°**: â­â­â­ çŸ­æœŸæ”¶ç›Šæ˜æ˜¾ï¼Œä½†ä¸è§£å†³æ ¸å¿ƒé—®é¢˜

---

### æ–¹æ¡ˆ B: OpenAI è¿æ¥ä¼˜åŒ– (ä¸­æœŸä¼˜åŒ–)

```python
# å½“å‰: æ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°è¿æ¥
client = AsyncOpenAI()

# ä¼˜åŒ–: HTTP/2 è¿æ¥å¤ç”¨ + Keep-Alive
client = AsyncOpenAI(
    http_client=httpx.AsyncClient(
        http2=True,
        limits=httpx.Limits(
            max_keepalive_connections=10,
            keepalive_expiry=30
        )
    )
)
```

**ä¼˜ç‚¹**:
- å¤ç”¨ TCP è¿æ¥ï¼Œçœå» TLS æ¡æ‰‹
- æ¯æ¬¡è¯·æ±‚èŠ‚çœ 100-300ms
- æ”¹åŠ¨å°ï¼Œé£é™©ä½

**ç¼ºç‚¹**:
- éœ€è¦éªŒè¯ Lambda ç¯å¢ƒå…¼å®¹æ€§
- ä¸èƒ½è§£å†³ OpenAI æœ¬èº«çš„å»¶è¿Ÿ

**è¯„ä¼°**: â­â­â­â­ å¿…åšä¼˜åŒ–ï¼Œæ”¶ç›Šç¨³å®š

---

### æ–¹æ¡ˆ C: Whisper æœ¬åœ°åŒ– (æ¶æ„å‡çº§)

```
å½“å‰:  éŸ³é¢‘ â†’ Lambda â†’ OpenAI Whisper API
ä¼˜åŒ–å: éŸ³é¢‘ â†’ EC2/ECS (æœ¬åœ° Whisper) â†’ ç»“æœ
```

**æŠ€æœ¯é€‰å‹**:
- [Faster-Whisper](https://github.com/guillaumekln/faster-whisper): 4x åŠ é€Ÿ
- GPU å®ä¾‹ (g4dn.xlarge): ~$0.50/å°æ—¶

**ä¼˜ç‚¹**:
- Whisper å»¶è¿Ÿé™åˆ° 1-2 ç§’
- ä¸ä¾èµ– OpenAI API ç¨³å®šæ€§
- é•¿æœŸæˆæœ¬å¯èƒ½æ›´ä½

**ç¼ºç‚¹**:
- éœ€è¦ GPU å®ä¾‹ (æˆæœ¬å¢åŠ )
- æ¶æ„å¤æ‚åº¦å¢åŠ 
- éœ€è¦è‡ªå·±ç»´æŠ¤æ¨¡å‹

**è¯„ä¼°**: â­â­â­ é•¿æœŸæ–¹æ¡ˆï¼Œé«˜æ”¶ç›Šä½†é«˜æŠ•å…¥

---

### æ–¹æ¡ˆ D: æµå¼è½¬å½• (Wispr Flow çº§åˆ«)

```
Wispr Flow æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¯´è¯                                                             â”‚
â”‚   â†“ (å®æ—¶éŸ³é¢‘æµ)                                                     â”‚
â”‚ WebSocket â†’ Edge Server â†’ æµå¼è½¬å½• â†’ å®æ—¶æ˜¾ç¤º                        â”‚
â”‚                                                                      â”‚
â”‚ ç”¨æˆ·åœæ­¢è¯´è¯                                                         â”‚
â”‚   â†“ (æœ€ç»ˆç¡®è®¤)                                                       â”‚
â”‚ å®Œæ•´éŸ³é¢‘ â†’ AI æ¶¦è‰² â†’ æƒ…ç»ªåˆ†æ â†’ ä¿å­˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯é€‰å‹**:
- [OpenAI Realtime API](https://platform.openai.com/docs/guides/realtime)
- æˆ– [Deepgram](https://deepgram.com/) (æ›´å¿«çš„æµå¼è½¬å½•)

**ä¼˜ç‚¹**:
- çœŸæ­£çš„å®æ—¶ä½“éªŒ
- ç”¨æˆ·è¾¹è¯´è¾¹çœ‹åˆ°æ–‡å­—
- æ„ŸçŸ¥å»¶è¿Ÿæ¥è¿‘ 0

**ç¼ºç‚¹**:
- æ¶æ„å¤§æ”¹
- éœ€è¦ WebSocket åŸºç¡€è®¾æ–½
- æˆæœ¬å¯èƒ½å¢åŠ 
- å¼€å‘å‘¨æœŸ 2-4 å‘¨

**è¯„ä¼°**: â­â­â­â­â­ ç»ˆææ–¹æ¡ˆï¼Œä½†æŠ•å…¥æœ€å¤§

---

## 3. ä¸“å®¶æ¨èï¼šåˆ†é˜¶æ®µå®æ–½

### Phase 1: ç«‹å³è¯Šæ–­ (ä»Šå¤©)

**ç›®æ ‡**: ç¡®è®¤ OpenAI æ…¢æ˜¯æˆ‘ä»¬çš„é—®é¢˜è¿˜æ˜¯ OpenAI çš„é—®é¢˜

**è¡ŒåŠ¨**:
1. æ£€æŸ¥ https://status.openai.com
2. ä»æœ¬åœ°ç›´æ¥æµ‹è¯• OpenAI API é€Ÿåº¦
3. æ£€æŸ¥ Lambda æ˜¯å¦åœ¨ VPC ä¸­

```bash
# æœ¬åœ°æµ‹è¯• OpenAI é€Ÿåº¦
curl -w "\nTime: %{time_total}s\n" \
  https://api.openai.com/v1/chat/completions \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"model":"gpt-4o-mini","messages":[{"role":"user","content":"Hi"}],"max_tokens":10}'
```

**é¢„æœŸç»“æœ**:
- å¦‚æœæœ¬åœ° <2 ç§’ï¼ŒLambda >10 ç§’ â†’ ç½‘ç»œé—®é¢˜
- å¦‚æœæœ¬åœ°ä¹Ÿ >5 ç§’ â†’ OpenAI é—®é¢˜

---

### Phase 2: å¿«é€Ÿä¼˜åŒ– (æœ¬å‘¨)

**ä¼˜å…ˆçº§æ’åº**:

| ä¼˜å…ˆçº§ | æ”¹åŠ¨ | é¢„æœŸæ”¶ç›Š | å·¥ä½œé‡ |
|--------|------|----------|--------|
| P0 | OpenAI è¿æ¥æ± ä¼˜åŒ– | -1s | 2å°æ—¶ |
| P0 | Prompt ç²¾ç®€ (emotion) | -0.5s | 1å°æ—¶ |
| P1 | Base64 ç›´ä¼  (çŸ­å½•éŸ³) | -2s | 1å¤© |
| P2 | Lambda ç§»å‡º VPC (å¦‚åœ¨ VPC) | -1s | 2å°æ—¶ |

**ä»£ç æ”¹åŠ¨**:

```python
# backend/app/services/openai_service.py

# 1. æ·»åŠ  HTTP/2 è¿æ¥æ± 
import httpx

class OpenAIService:
    def __init__(self):
        # åˆ›å»ºä¼˜åŒ–çš„ HTTP å®¢æˆ·ç«¯
        self._http_client = httpx.AsyncClient(
            http2=True,
            limits=httpx.Limits(
                max_keepalive_connections=10,
                keepalive_expiry=30
            ),
            timeout=httpx.Timeout(60.0)
        )

        self.async_client = AsyncOpenAI(
            api_key=settings.openai_api_key,
            http_client=self._http_client
        )
```

---

### Phase 3: æ¶æ„ä¼˜åŒ– (ä¸‹å‘¨)

**å¦‚æœ Phase 2 åä»ç„¶ >15 ç§’**:

1. **è€ƒè™‘ Whisper æœ¬åœ°åŒ–**
   - éƒ¨ç½² Faster-Whisper åˆ° EC2 g4dn.xlarge
   - é¢„æœŸ Whisper é™åˆ° 1-2 ç§’

2. **æˆ–åˆ‡æ¢åˆ° Deepgram**
   - æ¯” OpenAI Whisper å¿« 2-3x
   - ä»·æ ¼ç±»ä¼¼
   - æœ‰æµå¼ API

---

### Phase 4: æµå¼è½¬å½• (é•¿æœŸ)

**å½“ç”¨æˆ·é‡å¢é•¿ï¼Œä½“éªŒè¦æ±‚æ›´é«˜æ—¶**:

1. å®ç° WebSocket è¿æ¥
2. é›†æˆ OpenAI Realtime API æˆ– Deepgram æµå¼
3. å‰ç«¯å®æ—¶æ˜¾ç¤ºè½¬å½•æ–‡å­—

---

## 4. æ¨èæ–¹æ¡ˆ

### çŸ­æœŸ (æœ¬å‘¨): Phase 1 + Phase 2

**é¢„æœŸæ•ˆæœ**:
- å½“å‰: 30 ç§’
- ä¼˜åŒ–å: 15-20 ç§’
- æ”¹å–„: 30-50%

**å·¥ä½œé‡**: 1-2 å¤©

### ä¸­æœŸ (2å‘¨å†…): + Phase 3

**é¢„æœŸæ•ˆæœ**:
- ä¼˜åŒ–å: 8-12 ç§’
- æ”¹å–„: 60-70%

**å·¥ä½œé‡**: 3-5 å¤©

### é•¿æœŸ (1-2æœˆ): + Phase 4

**é¢„æœŸæ•ˆæœ**:
- ä¼˜åŒ–å: æ„ŸçŸ¥å»¶è¿Ÿ <3 ç§’
- è¾¾åˆ° Wispr Flow çº§åˆ«

**å·¥ä½œé‡**: 2-4 å‘¨

---

## 5. å†³ç­–å»ºè®®

ä½œä¸º CTOï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼š

1. **ä»Šå¤©å…ˆåšè¯Šæ–­** - ç¡®è®¤é—®é¢˜æ ¹æº
2. **æœ¬å‘¨åš Phase 2** - ä½é£é™©ã€ç¨³å®šæ”¶ç›Š
3. **æ ¹æ®æ•ˆæœå†³å®šæ˜¯å¦åš Phase 3/4**

**ä¸å»ºè®®ç«‹å³åš**:
- âŒ ç«‹å³ä¸Šæµå¼è½¬å½• (æŠ•å…¥å¤ªå¤§ï¼Œæ”¶ç›Šä¸ç¡®å®š)
- âŒ æ¢æ‰æ•´ä¸ª OpenAI (è¿ç§»æˆæœ¬é«˜)

**å»ºè®®ä¼˜å…ˆåš**:
- âœ… è¿æ¥æ± ä¼˜åŒ– (å¿…åš)
- âœ… Prompt ç²¾ç®€ (å¿…åš)
- âœ… è¯Šæ–­ç½‘ç»œé—®é¢˜ (å¿…åš)
- âš ï¸ Base64 ç›´ä¼  (å¯é€‰ï¼Œè§†è¯Šæ–­ç»“æœ)

---

## 6. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

è¯·å‘Šè¯‰æˆ‘ï¼š

1. **ä½ æƒ³å…ˆåšå“ªä¸ªï¼Ÿ**
   - A) è¯Šæ–­ OpenAI æ˜¯å¦çœŸçš„æ…¢ (5åˆ†é’Ÿ)
   - B) ç›´æ¥å®æ–½è¿æ¥æ± ä¼˜åŒ– (2å°æ—¶)
   - C) ç›´æ¥å®æ–½ Base64 ç›´ä¼  (1å¤©)

2. **Lambda æ˜¯å¦åœ¨ VPC ä¸­ï¼Ÿ**
   - åœ¨ AWS Lambda æ§åˆ¶å° â†’ ä½ çš„å‡½æ•° â†’ Configuration â†’ VPC æŸ¥çœ‹

---

**æ–‡æ¡£ç»´æŠ¤è€…**: CTO Office
**æœ€åæ›´æ–°**: 2026-01-30
