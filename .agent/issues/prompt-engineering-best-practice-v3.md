# Issue: Prompt Engineering Best Practice v3 - 教科书级别优化

**Type:** improvement
**Priority:** high
**Effort:** medium
**Status:** ✅ completed

---

## TL;DR

优化 AI 系统提示词，解决两个核心问题：
1. 润色内容无分段、无标点，阅读体验差
2. AI 反馈固定 1-2 句，缺乏温度感

---

## 问题描述

### 问题 1：润色内容格式问题

**当前状态：**
- 长文本（2分钟录音）全部挤在一起，没有段落
- 结尾可能没有标点符号
- 阅读体验极差，不符合产品标准

**期望结果：**
- 100字以上内容必须分段
- 按主题/时间/情感转折自然分段
- 每段50-150字（中文）或2-4句（英文）
- 所有句子以标点符号结尾

### 问题 2：AI 反馈缺乏温度

**当前状态：**
- 固定规则：1-2 句话
- 用户表达很多时，回复太短显得敷衍

**期望结果：**
- 温度感优先，不是简短优先
- 动态长度：用户说得多，回复也增加
- 让用户感到被倾听和理解

---

## 解决方案

### 优化 1：润色提示词 (Polish Prompt v3)

```
核心改动：
1. 🚨 CRITICAL RULES - 将分段从"建议"升级为"必选项"
2. 专业作家分段指南 - 教 AI 按主题/时间/情感分段
3. 量化标准 - 每段50-150字，单段不超过200字
4. 正反例对比 - 同时展示错误和正确示例
```

**设计原则（Prompt Engineering Best Practice）：**
- 层次分明：🚨 > 【】> - 区分优先级
- 正例+反例：形成对比学习
- 具体量化：数字 > 模糊词
- 场景驱动：根据输入动态调整

### 优化 2：反馈提示词 (Feedback Prompt v3)

```
核心理念转变：
❌ 旧思路：简短优先 → "1-2 句话"
✅ 新思路：温度优先 → 动态长度

动态长度策略：
| 用户输入 | 反馈长度 |
|---------|---------|
| <50字   | 1-2句 (SHORT) |
| 50-150字 | 2-3句 (MEDIUM) |
| 150-300字 | 3-4句 (LONG) |
| >300字  | 4-5句 (EXTENDED) |
```

**设计原则：**
- 温度 > 简短：宁可多说暖心话
- 动态调整：匹配用户表达量
- 情绪共鸣：利用 Emotion Agent 结果
- 真诚陪伴：像朋友一样倾听

---

## 相关文件

| 文件 | 改动 |
|------|------|
| `backend/app/services/openai_service.py` | 重写 Polish/Feedback 系统提示词 |

---

## 验证清单

- [ ] 长文本（>100字）正确分段
- [ ] 每段有合理长度（50-150字）
- [ ] 所有句子以标点结尾
- [ ] 短输入（<50字）→ 1-2句反馈
- [ ] 长输入（>300字）→ 4-5句反馈
- [ ] 反馈有温度，不敷衍

---

## 📚 Prompt Engineering 学习笔记

### 1. 规则层级设计

```
🚨 CRITICAL (必须遵守)
↓
【标准规则】(应该遵守)
↓
- 建议 (可以灵活)
```

### 2. 正反例对比学习

```markdown
### ❌ BAD:
"一大段没有分段的文字..."

### ✅ GOOD:
"第一段。

第二段。

第三段。"
```

### 3. 动态行为设计

```python
if user_input < 50:
    mode = "SHORT"
elif user_input < 150:
    mode = "MEDIUM"
else:
    mode = "LONG"
```

### 4. 量化 > 模糊

```
❌ "长文本需要分段"
✅ ">100字符必须分段，每段50-150字"
```

---

**Created:** 2026-01-27
**Author:** Claude (AI Assistant)
