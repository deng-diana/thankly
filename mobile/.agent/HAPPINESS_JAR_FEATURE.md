# å¹¸ç¦ç½åŠŸèƒ½ - å®Œæ•´å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

**åŠŸèƒ½åç§°ï¼š** Happiness Jarï¼ˆå¹¸ç¦ç½ï¼‰

**æ ¸å¿ƒä»·å€¼ï¼š** è‡ªåŠ¨æ”¶é›†ç”¨æˆ·æ‰€æœ‰æ­£å‘æƒ…ç»ªçš„æ—¥è®°ï¼Œåˆ›å»ºä¸€ä¸ªä¸“å±çš„"å¿«ä¹å›å¿†ç©ºé—´"ã€‚

**ç”¨æˆ·åœºæ™¯ï¼š**

- ç”¨æˆ·æƒ³å¿«é€Ÿå›é¡¾æ‰€æœ‰å¿«ä¹æ—¶åˆ»
- ç”¨æˆ·æƒ…ç»ªä½è½æ—¶éœ€è¦æ­£èƒ½é‡
- ç”¨æˆ·æƒ³ç»Ÿè®¡è‡ªå·±çš„å¹¸ç¦ç¬é—´æ•°é‡

---

## ğŸ¯ äº§å“è®¾è®¡

### 1. å…¥å£è®¾è®¡

**ä½ç½®ï¼š** æ—¥è®°åˆ—è¡¨é¡µï¼ˆDiaryListScreenï¼‰é¡¶éƒ¨ï¼Œé—®å€™è¯­ä¸‹æ–¹

**è§†è§‰è®¾è®¡ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hi, Diana                           â”‚
â”‚ Anything to appreciate or capture?  â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Open your Happiness Jar  ğŸ¯ â”‚   â”‚
â”‚ â”‚ 18 moments that ignite      â”‚   â”‚
â”‚ â”‚ your days                   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–‡æ¡ˆï¼š**

- æ ‡é¢˜ï¼š`Open your Happiness Jar`
- å‰¯æ ‡é¢˜ï¼š`{count} moments that ignite your days`
- ç©ºçŠ¶æ€ï¼š`Start collecting your happy moments âœ¨`

**è§†è§‰å…ƒç´ ï¼š**

- èƒŒæ™¯è‰²ï¼šæ·¡æ©™è‰² `#FFF5E6`
- å¼ºè°ƒè‰²ï¼šå“ç‰Œæ©™ `#E56C45`
- ç½å­æ’ç”»ï¼šæ‰‹ç»˜é£æ ¼ï¼Œå†…å«å°çº¸æ¡

---

### 2. å¹¸ç¦ç½é¡µé¢ï¼ˆHappinessJarScreenï¼‰

**é¡µé¢ç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Happiness Jar              ğŸ”Š     â”‚  â† è¿”å›æŒ‰é’® + éŸ³ä¹å¼€å…³
â”‚                                     â”‚
â”‚ ğŸ¯ ä½ å·²ç»æ”¶é›†äº† 18 ä¸ªå¿«ä¹ç¬é—´ âœ¨      â”‚  â† ç»Ÿè®¡ä¿¡æ¯
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“… Jan 15, 2026             â”‚   â”‚
â”‚ â”‚ ä»Šå¤©å’Œæœ‹å‹å»çˆ¬å±±ï¼Œçœ‹åˆ°äº†æ—¥å‡ºï¼  â”‚   â”‚  â† æ—¥è®°å¡ç‰‡
â”‚ â”‚ ğŸ˜Š Joyful                   â”‚   â”‚
â”‚ â”‚ [å›¾ç‰‡]                      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“… Jan 10, 2026             â”‚   â”‚
â”‚ â”‚ ...                         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡ç»†èŠ‚ï¼š**

- ä¸»é¢˜è‰²ï¼šæ¸©æš–é‡‘é»„è‰² `#FFD700` + æŸ”å’Œæ©™è‰²
- å¡ç‰‡å…‰æ™•ï¼šæ·¡é‡‘è‰²è¾¹æ¡† `rgba(255, 215, 0, 0.3)`
- è¿›å…¥åŠ¨ç”»ï¼šå¡ç‰‡ä»ä¸‹å¾€ä¸Šé£˜å…¥ï¼ˆ0.3s ease-outï¼‰
- ç©ºçŠ¶æ€æ’ç”»ï¼šç©ºç½å­ + "å¼€å§‹è®°å½•ä½ çš„å¿«ä¹æ—¶åˆ»å§ï¼"

---

### 3. èƒŒæ™¯éŸ³ä¹åŠŸèƒ½

**éŸ³ä¹é£æ ¼ï¼š** èˆ’ç¼“çº¯éŸ³ä¹ï¼ˆé’¢ç´ç‹¬å¥ / Lo-fi Chillï¼‰

**ç”¨æˆ·ä½“éªŒï¼š**

- è¿›å…¥é¡µé¢è‡ªåŠ¨æ’­æ”¾ï¼ˆéŸ³é‡ 30%ï¼‰
- å¾ªç¯æ’­æ”¾
- å³ä¸Šè§’éŸ³ä¹å›¾æ ‡å¯å¼€å…³
- ç¦»å¼€é¡µé¢è‡ªåŠ¨åœæ­¢

**é¦–æ¬¡è¿›å…¥æç¤ºï¼š**

```
Toast: "ğŸµ è½»éŸ³ä¹å·²ä¸ºä½ å‡†å¤‡å¥½ï¼Œç‚¹å‡»å³ä¸Šè§’å¯å…³é—­"
```

**éŸ³é¢‘è¦æ±‚ï¼š**

- æ ¼å¼ï¼šMP3 æˆ– M4A
- æ—¶é•¿ï¼š2-3 åˆ†é’Ÿ
- å¤§å°ï¼š< 2MB
- ç‰ˆæƒï¼šå…è´¹éŸ³ä¹åº“ï¼ˆEpidemic Sound / Artlistï¼‰

---

## ğŸ”§ æŠ€æœ¯æ¶æ„

### 1. æ•°æ®åº“è®¾è®¡

**æ— éœ€æ–°å»ºè¡¨ï¼** å¤ç”¨ç°æœ‰ `diary` è¡¨ã€‚

**ç­›é€‰é€»è¾‘ï¼š**

```sql
SELECT * FROM diary
WHERE user_id = :user_id
  AND emotion IN ('Joyful', 'Excited', 'Grateful', 'Confident', 'Peaceful', 'Hopeful')
ORDER BY created_at DESC
LIMIT 50
```

**æ­£å‘æƒ…ç»ªåˆ—è¡¨ï¼š**

- `Joyful` â€” å¿«ä¹
- `Excited` â€” å…´å¥‹
- `Grateful` â€” æ„Ÿæ©
- `Confident` â€” è‡ªä¿¡
- `Peaceful` â€” å¹³é™
- `Hopeful` â€” å……æ»¡å¸Œæœ›

---

### 2. åç«¯ API è®¾è®¡

#### **æ¥å£ 1ï¼šè·å–å¹¸ç¦ç½æ—¥è®°åˆ—è¡¨**

**Endpoint:**

```
GET /api/diary/happiness-jar
```

**è¯·æ±‚å‚æ•°ï¼š**

```json
{
  "user_id": "string (required)",
  "limit": "integer (optional, default: 50)",
  "offset": "integer (optional, default: 0)"
}
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "total": 23,
    "diaries": [
      {
        "id": "abc123",
        "content": "ä»Šå¤©å’Œæœ‹å‹å»çˆ¬å±±ï¼Œçœ‹åˆ°äº†æ—¥å‡ºï¼",
        "emotion": "Joyful",
        "emotion_display": "å¿«ä¹",
        "created_at": "2026-01-15T08:00:00Z",
        "images": ["https://..."],
        "audio_url": "https://...",
        "ai_feedback": "..."
      }
    ]
  }
}
```

**é”™è¯¯å¤„ç†ï¼š**

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "User not authenticated"
  }
}
```

---

#### **æ¥å£ 2ï¼šè·å–å¹¸ç¦ç½ç»Ÿè®¡**

**Endpoint:**

```
GET /api/diary/happiness-jar/stats
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "total_count": 23,
    "emotion_breakdown": {
      "Joyful": 10,
      "Excited": 5,
      "Grateful": 4,
      "Confident": 2,
      "Peaceful": 1,
      "Hopeful": 1
    },
    "first_moment": "2025-06-15T10:00:00Z",
    "latest_moment": "2026-01-15T08:00:00Z"
  }
}
```

---

### 3. åç«¯å®ç°ï¼ˆPython FastAPIï¼‰

**æ–‡ä»¶è·¯å¾„ï¼š** `backend/app/routers/diary.py`

```python
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from typing import List
from app.database import get_db
from app.models import Diary
from app.auth import get_current_user

router = APIRouter()

# æ­£å‘æƒ…ç»ªåˆ—è¡¨
POSITIVE_EMOTIONS = ['Joyful', 'Excited', 'Grateful', 'Confident', 'Peaceful', 'Hopeful']

@router.get("/happiness-jar")
async def get_happiness_jar(
    limit: int = 50,
    offset: int = 0,
    db: Session = Depends(get_db),
    current_user = Depends(get_current_user)
):
    """
    è·å–ç”¨æˆ·çš„å¹¸ç¦ç½æ—¥è®°åˆ—è¡¨
    """
    try:
        # æŸ¥è¯¢æ­£å‘æƒ…ç»ªçš„æ—¥è®°
        diaries = db.query(Diary).filter(
            Diary.user_id == current_user.id,
            Diary.emotion.in_(POSITIVE_EMOTIONS)
        ).order_by(
            Diary.created_at.desc()
        ).offset(offset).limit(limit).all()

        # ç»Ÿè®¡æ€»æ•°
        total = db.query(Diary).filter(
            Diary.user_id == current_user.id,
            Diary.emotion.in_(POSITIVE_EMOTIONS)
        ).count()

        return {
            "success": True,
            "data": {
                "total": total,
                "diaries": [diary.to_dict() for diary in diaries]
            }
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))


@router.get("/happiness-jar/stats")
async def get_happiness_jar_stats(
    db: Session = Depends(get_db),
    current_user = Depends(get_current_user)
):
    """
    è·å–å¹¸ç¦ç½ç»Ÿè®¡ä¿¡æ¯
    """
    try:
        # æŸ¥è¯¢æ‰€æœ‰æ­£å‘æƒ…ç»ªæ—¥è®°
        diaries = db.query(Diary).filter(
            Diary.user_id == current_user.id,
            Diary.emotion.in_(POSITIVE_EMOTIONS)
        ).all()

        # ç»Ÿè®¡å„æƒ…ç»ªæ•°é‡
        emotion_breakdown = {}
        for emotion in POSITIVE_EMOTIONS:
            count = sum(1 for d in diaries if d.emotion == emotion)
            if count > 0:
                emotion_breakdown[emotion] = count

        # è·å–ç¬¬ä¸€æ¡å’Œæœ€æ–°ä¸€æ¡
        first_moment = min(diaries, key=lambda d: d.created_at) if diaries else None
        latest_moment = max(diaries, key=lambda d: d.created_at) if diaries else None

        return {
            "success": True,
            "data": {
                "total_count": len(diaries),
                "emotion_breakdown": emotion_breakdown,
                "first_moment": first_moment.created_at if first_moment else None,
                "latest_moment": latest_moment.created_at if latest_moment else None
            }
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

---

### 4. å‰ç«¯å®ç°ï¼ˆReact Nativeï¼‰

#### **æ–‡ä»¶ç»“æ„ï¼š**

```
mobile/src/
â”œâ”€â”€ screens/
â”‚   â””â”€â”€ HappinessJarScreen.tsx       # å¹¸ç¦ç½ä¸»é¡µé¢
â”œâ”€â”€ components/
â”‚   â””â”€â”€ HappinessJarCard.tsx         # å…¥å£å¡ç‰‡ç»„ä»¶
â”œâ”€â”€ services/
â”‚   â””â”€â”€ happinessJarService.ts       # API è°ƒç”¨
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ music/
â”‚   â”‚   â””â”€â”€ happiness-jar-bgm.mp3    # èƒŒæ™¯éŸ³ä¹
â”‚   â””â”€â”€ images/
â”‚       â””â”€â”€ jar-icon.png             # ç½å­å›¾æ ‡
â””â”€â”€ i18n/
    â”œâ”€â”€ en.ts                        # è‹±æ–‡æ–‡æ¡ˆ
    â””â”€â”€ zh.ts                        # ä¸­æ–‡æ–‡æ¡ˆ
```

---

#### **Step 1: API Service**

**æ–‡ä»¶ï¼š** `mobile/src/services/happinessJarService.ts`

```typescript
import { API_BASE_URL } from "../config";
import { getAuthToken } from "../utils/auth";

export interface HappinessJarDiary {
  id: string;
  content: string;
  emotion: string;
  emotion_display: string;
  created_at: string;
  images: string[];
  audio_url?: string;
  ai_feedback?: string;
}

export interface HappinessJarResponse {
  success: boolean;
  data: {
    total: number;
    diaries: HappinessJarDiary[];
  };
}

export const happinessJarService = {
  /**
   * è·å–å¹¸ç¦ç½æ—¥è®°åˆ—è¡¨
   */
  async getDiaries(
    limit: number = 50,
    offset: number = 0,
  ): Promise<HappinessJarResponse> {
    const token = await getAuthToken();
    const response = await fetch(
      `${API_BASE_URL}/diary/happiness-jar?limit=${limit}&offset=${offset}`,
      {
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        },
      },
    );

    if (!response.ok) {
      throw new Error("Failed to fetch happiness jar");
    }

    return response.json();
  },

  /**
   * è·å–å¹¸ç¦ç½ç»Ÿè®¡
   */
  async getStats() {
    const token = await getAuthToken();
    const response = await fetch(`${API_BASE_URL}/diary/happiness-jar/stats`, {
      headers: {
        Authorization: `Bearer ${token}`,
        "Content-Type": "application/json",
      },
    });

    if (!response.ok) {
      throw new Error("Failed to fetch happiness jar stats");
    }

    return response.json();
  },
};
```

---

#### **Step 2: å…¥å£å¡ç‰‡ç»„ä»¶**

**æ–‡ä»¶ï¼š** `mobile/src/components/HappinessJarCard.tsx`

```typescript
import React, { useEffect, useState } from 'react';
import { View, Text, TouchableOpacity, StyleSheet, Image } from 'react-native';
import { useNavigation } from '@react-navigation/native';
import { happinessJarService } from '../services/happinessJarService';
import { useTranslation } from '../i18n';

export const HappinessJarCard: React.FC = () => {
  const navigation = useNavigation();
  const { t } = useTranslation();
  const [count, setCount] = useState<number>(0);

  useEffect(() => {
    loadCount();
  }, []);

  const loadCount = async () => {
    try {
      const stats = await happinessJarService.getStats();
      setCount(stats.data.total_count);
    } catch (error) {
      console.error('Failed to load happiness jar count:', error);
    }
  };

  const handlePress = () => {
    navigation.navigate('HappinessJar');
  };

  return (
    <TouchableOpacity
      style={styles.container}
      onPress={handlePress}
      activeOpacity={0.8}
    >
      <View style={styles.content}>
        <View style={styles.textContainer}>
          <Text style={styles.title}>
            {t('happinessJar.openYour')}
            <Text style={styles.highlight}> {t('happinessJar.happiness')}</Text>
            {t('happinessJar.jar')}
          </Text>
          <Text style={styles.subtitle}>
            <Text style={styles.count}>{count}</Text> {t('happinessJar.moments')}
          </Text>
        </View>
        <Image
          source={require('../assets/images/jar-icon.png')}
          style={styles.jarIcon}
          resizeMode="contain"
        />
      </View>
    </TouchableOpacity>
  );
};

const styles = StyleSheet.create({
  container: {
    backgroundColor: '#FFF5E6',
    borderRadius: 16,
    padding: 20,
    marginHorizontal: 16,
    marginVertical: 12,
    shadowColor: '#E56C45',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 8,
    elevation: 3,
  },
  content: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  textContainer: {
    flex: 1,
  },
  title: {
    fontSize: 18,
    fontFamily: 'Lora-Regular',
    color: '#332824',
    marginBottom: 4,
  },
  highlight: {
    color: '#E56C45',
    fontFamily: 'Lora-Bold',
  },
  subtitle: {
    fontSize: 14,
    fontFamily: 'Lora-Regular',
    color: '#80645A',
  },
  count: {
    fontSize: 16,
    fontFamily: 'Lora-Bold',
    color: '#E56C45',
  },
  jarIcon: {
    width: 60,
    height: 60,
  },
});
```

---

#### **Step 3: å¹¸ç¦ç½ä¸»é¡µé¢**

**æ–‡ä»¶ï¼š** `mobile/src/screens/HappinessJarScreen.tsx`

```typescript
import React, { useState, useEffect, useRef } from 'react';
import {
  View,
  Text,
  FlatList,
  StyleSheet,
  TouchableOpacity,
  ActivityIndicator,
  Animated,
} from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { Audio } from 'expo-av';
import { happinessJarService, HappinessJarDiary } from '../services/happinessJarService';
import { DiaryCard } from '../components/DiaryCard';
import { useTranslation } from '../i18n';
import Toast from 'react-native-toast-message';

export const HappinessJarScreen: React.FC = () => {
  const { t } = useTranslation();
  const [diaries, setDiaries] = useState<HappinessJarDiary[]>([]);
  const [loading, setLoading] = useState(true);
  const [sound, setSound] = useState<Audio.Sound | null>(null);
  const [isMusicEnabled, setIsMusicEnabled] = useState(true);
  const fadeAnim = useRef(new Animated.Value(0)).current;

  useEffect(() => {
    loadDiaries();
    loadAndPlayMusic();
    showMusicToast();

    // è¿›å…¥åŠ¨ç”»
    Animated.timing(fadeAnim, {
      toValue: 1,
      duration: 500,
      useNativeDriver: true,
    }).start();

    return () => {
      // ç¦»å¼€é¡µé¢æ—¶åœæ­¢éŸ³ä¹
      if (sound) {
        sound.unloadAsync();
      }
    };
  }, []);

  const loadDiaries = async () => {
    try {
      const response = await happinessJarService.getDiaries();
      setDiaries(response.data.diaries);
    } catch (error) {
      console.error('Failed to load happiness jar:', error);
      Toast.show({
        type: 'error',
        text1: t('happinessJar.loadError'),
      });
    } finally {
      setLoading(false);
    }
  };

  const loadAndPlayMusic = async () => {
    try {
      const { sound: newSound } = await Audio.Sound.createAsync(
        require('../assets/music/happiness-jar-bgm.mp3'),
        {
          shouldPlay: true,
          isLooping: true,
          volume: 0.3,
        }
      );
      setSound(newSound);
    } catch (error) {
      console.log('Music load failed:', error);
    }
  };

  const showMusicToast = () => {
    setTimeout(() => {
      Toast.show({
        type: 'info',
        text1: 'ğŸµ ' + t('happinessJar.musicReady'),
        visibilityTime: 3000,
      });
    }, 500);
  };

  const toggleMusic = async () => {
    if (sound) {
      if (isMusicEnabled) {
        await sound.pauseAsync();
      } else {
        await sound.playAsync();
      }
      setIsMusicEnabled(!isMusicEnabled);
    }
  };

  const renderHeader = () => (
    <View style={styles.header}>
      <Text style={styles.headerText}>
        ğŸ¯ {t('happinessJar.collected')}
        <Text style={styles.count}> {diaries.length} </Text>
        {t('happinessJar.moments')} âœ¨
      </Text>
    </View>
  );

  const renderEmpty = () => (
    <View style={styles.emptyContainer}>
      <Text style={styles.emptyText}>
        {t('happinessJar.emptyState')}
      </Text>
    </View>
  );

  if (loading) {
    return (
      <View style={styles.loadingContainer}>
        <ActivityIndicator size="large" color="#E56C45" />
      </View>
    );
  }

  return (
    <View style={styles.container}>
      {/* éŸ³ä¹å¼€å…³ */}
      <TouchableOpacity
        style={styles.musicToggle}
        onPress={toggleMusic}
      >
        <Ionicons
          name={isMusicEnabled ? 'volume-high' : 'volume-mute'}
          size={24}
          color="#E56C45"
        />
      </TouchableOpacity>

      {/* æ—¥è®°åˆ—è¡¨ */}
      <Animated.View style={{ flex: 1, opacity: fadeAnim }}>
        <FlatList
          data={diaries}
          renderItem={({ item }) => <DiaryCard diary={item} />}
          keyExtractor={(item) => item.id}
          ListHeaderComponent={renderHeader}
          ListEmptyComponent={renderEmpty}
          contentContainerStyle={styles.listContent}
        />
      </Animated.View>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#FFFBF5',
  },
  musicToggle: {
    position: 'absolute',
    top: 60,
    right: 20,
    zIndex: 10,
    backgroundColor: '#FFF',
    borderRadius: 20,
    padding: 8,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
  header: {
    paddingVertical: 24,
    paddingHorizontal: 20,
    alignItems: 'center',
  },
  headerText: {
    fontSize: 18,
    fontFamily: 'Lora-Regular',
    color: '#332824',
    textAlign: 'center',
  },
  count: {
    fontSize: 20,
    fontFamily: 'Lora-Bold',
    color: '#E56C45',
  },
  listContent: {
    paddingBottom: 40,
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: '#FFFBF5',
  },
  emptyContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    paddingVertical: 60,
  },
  emptyText: {
    fontSize: 16,
    fontFamily: 'Lora-Regular',
    color: '#80645A',
    textAlign: 'center',
  },
});
```

---

#### **Step 4: å›½é™…åŒ–æ–‡æ¡ˆ**

**æ–‡ä»¶ï¼š** `mobile/src/i18n/en.ts`

```typescript
export default {
  // ... å…¶ä»–ç¿»è¯‘
  happinessJar: {
    openYour: "Open your",
    happiness: "Happiness",
    jar: "Jar",
    moments: "moments that ignite your days",
    collected: "You have collected",
    emptyState: "Start collecting your happy moments âœ¨",
    loadError: "Failed to load happiness jar",
    musicReady: "Soft music is ready, tap top-right to turn off",
  },
};
```

**æ–‡ä»¶ï¼š** `mobile/src/i18n/zh.ts`

```typescript
export default {
  // ... å…¶ä»–ç¿»è¯‘
  happinessJar: {
    openYour: "æ‰“å¼€ä½ çš„",
    happiness: "å¹¸ç¦",
    jar: "ç½",
    moments: "ä¸ªç‚¹äº®ç”Ÿæ´»çš„ç¬é—´",
    collected: "ä½ å·²ç»æ”¶é›†äº†",
    emptyState: "å¼€å§‹è®°å½•ä½ çš„å¿«ä¹æ—¶åˆ»å§ âœ¨",
    loadError: "åŠ è½½å¹¸ç¦ç½å¤±è´¥",
    musicReady: "è½»éŸ³ä¹å·²ä¸ºä½ å‡†å¤‡å¥½ï¼Œç‚¹å‡»å³ä¸Šè§’å¯å…³é—­",
  },
};
```

---

#### **Step 5: æ·»åŠ è·¯ç”±**

**æ–‡ä»¶ï¼š** `mobile/src/navigation/AppNavigator.tsx`

```typescript
import { HappinessJarScreen } from '../screens/HappinessJarScreen';

// åœ¨ Stack.Navigator ä¸­æ·»åŠ 
<Stack.Screen
  name="HappinessJar"
  component={HappinessJarScreen}
  options={{
    title: 'Happiness Jar',
    headerStyle: {
      backgroundColor: '#FFFBF5',
    },
    headerTintColor: '#332824',
    headerTitleStyle: {
      fontFamily: 'Lora-Bold',
    },
  }}
/>
```

---

#### **Step 6: é›†æˆåˆ°é¦–é¡µ**

**æ–‡ä»¶ï¼š** `mobile/src/screens/DiaryListScreen.tsx`

```typescript
import { HappinessJarCard } from '../components/HappinessJarCard';

// åœ¨ renderHeader å‡½æ•°ä¸­æ·»åŠ 
const renderHeader = () => (
  <View>
    <Text style={styles.greeting}>Hi, {userName}</Text>
    <Text style={styles.subtitle}>Anything to appreciate or capture today?</Text>

    {/* å¹¸ç¦ç½å…¥å£ */}
    <HappinessJarCard />

    <Text style={styles.sectionTitle}>My precious moment</Text>
  </View>
);
```

---

## ğŸš€ å®æ–½æ­¥éª¤

### Phase 1: åç«¯å¼€å‘ï¼ˆ1 å¤©ï¼‰

1. âœ… åœ¨ `diary.py` ä¸­æ·»åŠ ä¸¤ä¸ª API æ¥å£
2. âœ… æµ‹è¯• APIï¼ˆä½¿ç”¨ Postman æˆ– curlï¼‰
3. âœ… éƒ¨ç½²åˆ° Lambda

### Phase 2: å‰ç«¯å¼€å‘ï¼ˆ2 å¤©ï¼‰

1. âœ… åˆ›å»º `happinessJarService.ts`
2. âœ… åˆ›å»º `HappinessJarCard.tsx`
3. âœ… åˆ›å»º `HappinessJarScreen.tsx`
4. âœ… æ·»åŠ å›½é™…åŒ–æ–‡æ¡ˆ
5. âœ… æ·»åŠ è·¯ç”±é…ç½®
6. âœ… é›†æˆåˆ°é¦–é¡µ

### Phase 3: éŸ³ä¹åŠŸèƒ½ï¼ˆ0.5 å¤©ï¼‰

1. âœ… ä¸‹è½½/è´­ä¹°èƒŒæ™¯éŸ³ä¹
2. âœ… æ·»åŠ åˆ° `assets/music/`
3. âœ… å®ç°éŸ³ä¹æ’­æ”¾é€»è¾‘
4. âœ… æµ‹è¯•éŸ³ä¹å¼€å…³

### Phase 4: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ0.5 å¤©ï¼‰

1. âœ… åŠŸèƒ½æµ‹è¯•ï¼ˆiOS + Androidï¼‰
2. âœ… æ€§èƒ½æµ‹è¯•ï¼ˆå¤§é‡æ—¥è®°æ—¶çš„åŠ è½½é€Ÿåº¦ï¼‰
3. âœ… UI ç»†èŠ‚è°ƒæ•´
4. âœ… ç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. åˆ†é¡µåŠ è½½

```typescript
const [page, setPage] = useState(0);
const PAGE_SIZE = 20;

const loadMore = async () => {
  const response = await happinessJarService.getDiaries(
    PAGE_SIZE,
    page * PAGE_SIZE,
  );
  setDiaries([...diaries, ...response.data.diaries]);
  setPage(page + 1);
};
```

### 2. ç¼“å­˜ç­–ç•¥

```typescript
import AsyncStorage from "@react-native-async-storage/async-storage";

// ç¼“å­˜æ—¥è®°åˆ—è¡¨
await AsyncStorage.setItem("happiness_jar_cache", JSON.stringify(diaries));

// è¯»å–ç¼“å­˜
const cached = await AsyncStorage.getItem("happiness_jar_cache");
if (cached) {
  setDiaries(JSON.parse(cached));
}
```

### 3. å›¾ç‰‡æ‡’åŠ è½½

```typescript
<Image
  source={{ uri: diary.images[0] }}
  style={styles.image}
  resizeMode="cover"
  loadingIndicatorSource={require('../assets/placeholder.png')}
/>
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### åç«¯æµ‹è¯•

```bash
# æµ‹è¯•è·å–å¹¸ç¦ç½åˆ—è¡¨
curl -X GET "http://localhost:8000/api/diary/happiness-jar?limit=10" \
  -H "Authorization: Bearer YOUR_TOKEN"

# æµ‹è¯•è·å–ç»Ÿè®¡
curl -X GET "http://localhost:8000/api/diary/happiness-jar/stats" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å‰ç«¯æµ‹è¯•

- [ ] å…¥å£å¡ç‰‡æ­£ç¡®æ˜¾ç¤ºæ•°é‡
- [ ] ç‚¹å‡»å¡ç‰‡è·³è½¬åˆ°å¹¸ç¦ç½é¡µé¢
- [ ] æ—¥è®°åˆ—è¡¨æ­£ç¡®åŠ è½½
- [ ] ç©ºçŠ¶æ€æ­£ç¡®æ˜¾ç¤º
- [ ] éŸ³ä¹è‡ªåŠ¨æ’­æ”¾
- [ ] éŸ³ä¹å¼€å…³æ­£å¸¸å·¥ä½œ
- [ ] ç¦»å¼€é¡µé¢éŸ³ä¹åœæ­¢
- [ ] ä¸‹æ‹‰åˆ·æ–°æ­£å¸¸
- [ ] åˆ†é¡µåŠ è½½æ­£å¸¸

---

## ğŸ¨ è®¾è®¡èµ„æº

### éœ€è¦å‡†å¤‡çš„èµ„æº

1. **ç½å­å›¾æ ‡** (`jar-icon.png`)
   - å°ºå¯¸ï¼š120x120px @3x
   - é£æ ¼ï¼šæ‰‹ç»˜ã€æ¸©æš–
2. **èƒŒæ™¯éŸ³ä¹** (`happiness-jar-bgm.mp3`)
   - æ—¶é•¿ï¼š2-3 åˆ†é’Ÿ
   - é£æ ¼ï¼šé’¢ç´ç‹¬å¥ / Lo-fi Chill
   - éŸ³é‡ï¼šé€‚ä¸­ï¼Œä¸åˆºè€³
3. **ç©ºçŠ¶æ€æ’ç”»** (`empty-jar.png`)
   - å°ºå¯¸ï¼š200x200px @3x
   - å†…å®¹ï¼šç©ºç½å­ + æ¸©é¦¨æç¤º

---

## ğŸ’¬ é¢è¯•è¯æœ¯

**é—®é¢˜ï¼šä»‹ç»ä¸€ä¸‹å¹¸ç¦ç½åŠŸèƒ½çš„è®¾è®¡æ€è·¯ã€‚**

**å›ç­”ï¼š**

> "å¹¸ç¦ç½æ˜¯ä¸€ä¸ªåŸºäºæƒ…ç»ªç­›é€‰çš„åŠŸèƒ½ã€‚æˆ‘ä»¬çš„ AI ä¼šç»™æ¯æ¡æ—¥è®°æ‰“ä¸Šæƒ…ç»ªæ ‡ç­¾ï¼Œå¹¸ç¦ç½ä¼šè‡ªåŠ¨æ”¶é›†æ‰€æœ‰æ­£å‘æƒ…ç»ªçš„æ—¥è®°ï¼Œæ¯”å¦‚ Joyfulã€Grateful ç­‰ã€‚
>
> æŠ€æœ¯ä¸Šï¼Œæˆ‘ä»¬ä¸éœ€è¦æ–°å»ºæ•°æ®åº“è¡¨ï¼Œåªéœ€è¦åœ¨æŸ¥è¯¢æ—¶åŠ ä¸€ä¸ª WHERE æ¡ä»¶ç­›é€‰æƒ…ç»ªã€‚åç«¯æä¾›äº†ä¸¤ä¸ª APIï¼šä¸€ä¸ªè¿”å›æ—¥è®°åˆ—è¡¨ï¼Œä¸€ä¸ªè¿”å›ç»Ÿè®¡ä¿¡æ¯ã€‚
>
> ç”¨æˆ·ä½“éªŒä¸Šï¼Œæˆ‘ä»¬è®¾è®¡äº†æ¸©æš–çš„é‡‘è‰²ä¸»é¢˜ï¼Œå¹¶åŠ å…¥äº†èˆ’ç¼“çš„èƒŒæ™¯éŸ³ä¹ï¼Œè®©ç”¨æˆ·åœ¨å›é¡¾å¿«ä¹æ—¶åˆ»æ—¶æœ‰æ›´å¼ºçš„æƒ…æ„Ÿå…±é¸£ã€‚éŸ³ä¹æ˜¯å¯é€‰çš„ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶å…³é—­ã€‚
>
> è¿™ä¸ªåŠŸèƒ½çš„æ ¸å¿ƒä»·å€¼æ˜¯å¸®åŠ©ç”¨æˆ·åœ¨æƒ…ç»ªä½è½æ—¶å¿«é€Ÿæ‰¾åˆ°æ­£èƒ½é‡ï¼Œæå‡ App çš„æƒ…æ„Ÿä»·å€¼å’Œç”¨æˆ·ç²˜æ€§ã€‚"

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

### æ•°æ®æŒ‡æ ‡

- å¹¸ç¦ç½æ‰“å¼€ç‡ > 30%ï¼ˆDAU ä¸­çš„å æ¯”ï¼‰
- å¹³å‡åœç•™æ—¶é•¿ > 2 åˆ†é’Ÿ
- éŸ³ä¹å¼€å¯ç‡ > 60%

### ç”¨æˆ·åé¦ˆ

- App Store è¯„è®ºæåŠ"å¹¸ç¦ç½"
- ç”¨æˆ·æˆªå›¾åˆ†äº«å¹¸ç¦ç½é¡µé¢

---

## ğŸ”„ æœªæ¥è¿­ä»£

### v1.3.0 å¯èƒ½çš„ä¼˜åŒ–

1. **åˆ†äº«åŠŸèƒ½ï¼š** å…è®¸ç”¨æˆ·åˆ†äº«å¹¸ç¦ç½æˆªå›¾åˆ°ç¤¾äº¤åª’ä½“
2. **æ—¶é—´ç­›é€‰ï¼š** æŒ‰æœˆä»½/å¹´ä»½æŸ¥çœ‹å¹¸ç¦ç½
3. **æƒ…ç»ªè¶‹åŠ¿ï¼š** æ˜¾ç¤ºå¿«ä¹æ—¶åˆ»çš„æ—¶é—´åˆ†å¸ƒå›¾
4. **éšæœºå›é¡¾ï¼š** "ä»Šå¤©çœ‹çœ‹ä¸€å¹´å‰çš„å¿«ä¹"

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æœç´¢åŠŸèƒ½å®æ–½æ–‡æ¡£](./SEARCH_FEATURE_IMPLEMENTATION.md)
- [æƒ…ç»ªè¯†åˆ« Agent è®¾è®¡](../backend/docs/EMOTION_AGENT.md)
- [UI è®¾è®¡è§„èŒƒ](./UI_DESIGN_GUIDELINES.md)

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2026-01-18  
**æœ€åæ›´æ–°ï¼š** 2026-01-18  
**è´Ÿè´£äººï¼š** Diana Deng
